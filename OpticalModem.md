# 文星光猫更换
（这里新光猫以华为的通版光猫为例，其它光猫自行找教程，并且不保证其它光猫可以成功）

## 一、查询旧光猫的SN号
文星这里的光猫身份认证是通过SN号进行认证的，所以要记下SN号，SN号可以在光猫底部的标签找到SN号，就是`PON No:`后面的内容，记下那个括号外面的SN号（不是括号里的），例如`PON No: 485754434B5C6D7E(HWTC4B5C6D7E)`，那么SN号就是`485754434B5C6D7E`，如果标签看不清楚，可以在光猫的网页管理界面上找到SN号，网页管理界面进入方法和下文新光猫的网页管理界面进入方法一致,见步骤三`连接新光猫`。

## 二、准备必要的软件工具
1. 下载并安装telnet客户端，Windows推荐使用自带的telnet客户端，开启方法见这个链接：[Windows开启telnet客户端方法](https://jingyan.baidu.com/article/6fb756ec6d8422651858fb9d.html)
2. （如果新光猫的shell不完整才需要）下载并安装`TFTP Server`软件，可以使用tftpd32或者tftpd64，下载链接：[tftpd64下载](https://pjo2.github.io/tftpd64/)，并下载allshell2.bin： [allshell.bin下载](https://pan.baidu.com/link/zhihu/7NhEzeuShIikUIZnNULwQhJTWxQWl3ZwdlRz==)

## 三、连接新光猫
1. 将旧光猫的所有线拔下，换上新光猫（最好先插光纤线，再插电源线），用网线连接新光猫和电脑，电脑的网线插到新光猫的LAN口上，等新光猫启动完成（LAN口的灯亮起来）。
2. 打开电脑的网络和共享中心，点击`更改适配器设置`，找到`本地连接`，右键点击`本地连接`，点击`属性`，在弹出的窗口中找到`Internet协议版本4（TCP/IPv4）`，双击打开，将`自动获取IP地址`改为`使用下面的IP地址`，IP地址填`192.168.100.11`，子网掩码填`255.255.255.0`，默认网关填`192.168.100.1`，点击`确定`保存设置。
3. 打开浏览器，输入`http://192.168.100.1`，账号是`telecomadmin`，密码是`admintelecom`（如果不对请重置新光猫），在设备信息中看到ONT注册状态应该是O3，如果是其它可能是光纤没插好，或者有其它问题，请确认状态是O3后再继续下一步。

## 四、配置新光猫
1. Windows打开`开始菜单`，在搜索框中输入`cmd`，打开命令提示符，输入`telnet 192.168.100.1`，使用其它telnet客户端的用户自行连接到这个地址，用户名为`root` ，密码是`admin`，如果不对请重置新光猫。
2. 接下来根据不同的光猫型号，修改SN号的流程可能不太一样，先讲最方便最简单的方案，如果成功了直接重启光猫后即可进入下一步：
> 输入命令`set sn snid xxx`，xxx为刚刚记录下来的旧猫的sn号

如果提示`Command is not existed`,则说明你的光猫不支持这个命令，那么请参考下面的方案：
> 输入命令`shell`，进入shell模式，如果提示`Command is not existed`,则先输入`su`，再输入`shell`  
输入命令`cd /mnt/jffs2/`，进入jffs2目录

如果提示`Command is not existed`,则输入说明shell也是阉割版的，那么请参考下面的方案：
> 打开tftpd64软件，current directory选择allshell2.bin所在的目录，server interfaces选择ip地址为你刚刚配置的ip地址`192.168.100.11`。  
回到刚刚打开的shell，输入命令`load pack by tftp svrip 192.168.100.11 remotefile allshell2.bin`

cd到/mnt/jffs2/后继续执行：
> 输入命令`vi hw_boardinfo`，进入vi编辑器，按`i`键进入编辑模式，将第二行引号内的内容改为你刚刚记录下来的旧猫的sn号，按`Esc`键退出编辑模式，输入`:wq`保存并退出vi编辑器，然后再输入命令``vi hw_boardinfo.bak`，同样修改第二行引号内的内容，并保存退出。

最后重启光猫，等待光猫重启完成，如果光猫的LAN口灯亮起来，说明光猫已经重启完成。
3. 打开浏览器，输入`http://192.168.100.1`，查看设备信息，如果ONT注册状态是O5，说明光猫已经成功注册了。

## 五、恢复电脑的网络设置
1. 打开电脑的网络和共享中心，点击`更改适配器设置`，找到`本地连接`，右键点击`本地连接`，点击`属性`，在弹出的窗口中找到`Internet协议版本4（TCP/IPv4）`，双击打开，将`使用下面的IP地址`改为`自动获取IP地址`，点击`确定`保存设置。
2. 把网线从电脑上拔下，插入路由器，配置路由器进行拨号上网，如果买的带路由器的光猫，可以直接配置光猫进行拨号上网，并且可以不用再接路由器（除非是很贵的两百左右的光猫，否则不推荐）。至此，光猫更换完成，进入[speedtest](https://www.speedtest.cn/)测速，看看网速是否正常。